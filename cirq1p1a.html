<!--
----------------------------------------------------------------------
 三角関数クイズ

 HTML(JavaScript, canvas)

 Physics (c) Ohtani 2025.8
----------------------------------------------------------------------
-->
<!DOctxYPE html>
<html lang="ja">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<head>
  <meta charset="utf-8">
  <title>三角関数クイズ</title>
</head>
<body>
<p id="CircularQuiz"></p>
<div style='float:left;'>
三角クイズ
<br>
<form id="target">
Level5 <input type="radio" id="lvl_5" name="amount" value="5" />5<pre></pre>
Level4 <input type="radio" id="lvl_4" name="amount" value="4" />4<pre></pre>
Level3 <input type="radio" id="lvl_3" name="amount" value="3" />3<pre></pre>
Level2 <input type="radio" id="lvl_2" name="amount" value="2" />2<pre></pre>
Level1 <input type="radio" id="lvl_1" name="amount" value="1" />1<pre></pre>
</form>
矢印shift abcdyn
<pre></pre>
<input type="button" id="butS" value="Reset" onclick="inkey(32)">Space
<pre></pre>
<input type="button" id="butR" value="角度0" onclick="inkey(13)">Enter
<pre></pre>
<input type="button" id="butQ" value="細"    onclick="inkey(81)">q
<input type="button" id="butW" value="太"    onclick="inkey(87)">w
<pre></pre>
<input type="button" id="butZ" value="縮"    onclick="inkey(90)">z 
<input type="button" id="butX" value="拡"    onclick="inkey(88)">x
<input type="button" id="butC" value="初"    onclick="inkey(67)">v
<pre></pre>

<script src="https://sciencemathhub.github.io/html/tophys.js"></script>
<script src="https://sciencemathhub.github.io/html/canlib.js"></script>
<script>
'use strict'

//--------------------------------------------------------------------
// Quiz level 1
//--------------------------------------------------------------------
const Qu11 = [
[ ["直角三角形の斜辺をa、θの対辺をb、残りの辺をc、とするとsinθはどれ"],
  ["", 1,"a","b"], ["", 1,"a","c"], ["", 1,"b","a"], ["", 1,"c","a"], 3
],
[ ["直角三角形の斜辺をb、θの対辺をc、残りの辺をa、とするとsinθはどれ"],
  ["", 1,"b","c"], ["", 1,"b","a"], ["", 1,"c","b"], ["", 1,"a","b"], 3
],
[ ["直角三角形の斜辺をc、θの対辺をa、残りの辺をb、とするとsinθはどれ"],
  ["", 1,"c","a"], ["", 1,"c","b"], ["", 1,"a","c"], ["", 1,"b","c"], 3
]];

const Qu12 = [
[ ["直角三角形の斜辺をa、θの対辺をb、残りの辺をc、とするとcosθはどれ"],
  ["", 1,"a","b"], ["", 1,"a","c"], ["", 1,"b","a"], ["", 1,"c","a"], 4
],
[ ["直角三角形の斜辺をb、θの対辺をc、残りの辺をa、とするとcosθはどれ"],
  ["", 1,"b","c"], ["", 1,"b","a"], ["", 1,"c","b"], ["", 1,"a","b"], 4
],
[ ["直角三角形の斜辺をc、θの対辺をa、残りの辺をb、とするとcosθはどれ"],
  ["", 1,"c","a"], ["", 1,"c","b"], ["", 1,"a","c"], ["", 1,"b","c"], 4
]];

const Qu13 = [
[ ["直角三角形の斜辺をa、θの対辺をb、残りの辺をc、とするとtanθはどれ"],
  ["", 1,"a","b"], ["", 1,"c","b"], ["", 1,"a","c"], ["", 1,"b","c"], 4
],
[ ["直角三角形の斜辺をb、θの対辺をc、残りの辺をa、とするとtanθはどれ"],
  ["", 1,"b","c"], ["", 1,"a","c"], ["", 1,"b","a"], ["", 1,"c","a"], 4
],
[ ["直角三角形の斜辺をc、θの対辺をa、残りの辺をb、とするとtanθはどれ"],
  ["", 1,"c","a"], ["", 1,"b","a"], ["", 1,"c","b"], ["", 1,"a","b"], 4
]];

const Qu14 = [
[ ["直角三角形の斜辺をa、θの対辺をb、残りの辺をc、とするとcはどれ"],
  ["asinθ"], ["acosθ"], ["", 5,"  b  ","sinθ"], ["", 5,"  c  ","cosθ"], 2
],
[ ["直角三角形の斜辺をb、θの対辺をc、残りの辺をa、とするとaはどれ"],
  ["bsinθ"], ["bcosθ"], ["", 5,"  c  ","sinθ"], ["", 5,"  a  ","cosθ"], 2
],
[ ["直角三角形の斜辺をc、θの対辺をa、残りの辺をb、とするとbはどれ"],
  ["csinθ"], ["ccosθ"], ["", 5,"  a  ","sinθ"], ["", 5,"  b  ","cosθ"], 2
]];

const Qu15 = [
[ ["直角三角形の斜辺をa、θの対辺をb、残りの辺をc、とするとbはどれ"],
  ["asinθ"], ["acosθ"], ["", 5,"  b  ","sinθ"], ["", 5,"  c  ","cosθ"], 1
],
[ ["直角三角形の斜辺をb、θの対辺をc、残りの辺をa、とするとcはどれ"],
  ["bsinθ"], ["bcosθ"], ["", 5,"  c  ","sinθ"], ["", 5,"  a  ","cosθ"], 1
],
[ ["直角三角形の斜辺をc、θの対辺をa、残りの辺をb、とするとaはどれ"],
  ["csinθ"], ["ccosθ"], ["", 5,"  a  ","sinθ"], ["", 5,"  b  ","cosθ"], 1
]];

//--------------------------------------------------------------------
// Quiz level 2
//--------------------------------------------------------------------
const Qu21 = [
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとsinθはどれ"],
  ["", 1,"x","r"], ["", 1,"y","r"], ["", 1,"r","x"], ["", 1,"r","y"], 2
],
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとcosθはどれ"],
  ["", 1,"x","r"], ["", 1,"y","r"], ["", 1,"r","x"], ["", 1,"r","y"], 1
],
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとtanθはどれ"],
  ["", 1,"x","r"], ["", 1,"y","r"], ["", 1,"x","y"], ["", 1,"y","x"], 4
]];

const Qu22 = [
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとxはどれ"],
  ["rsinθ"], ["rcosθ"], ["", 5,"sinθ","  r"], ["", 5,"cosθ","  r"], 2
],
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとyはどれ"],
  ["rsinθ"], ["rcosθ"], ["", 5,"sinθ","  r"], ["", 5,"cosθ","  r"], 1
]];

const Qu23 = [
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとrはどれ"],
  ["", 5,"sinθ","  x  "], ["", 5,"cosθ","  x  "],
  ["", 5,"  x  ","sinθ"], ["", 5,"  x  ","cosθ"], 4
],
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとrはどれ"],
  ["", 5,"sinθ","  y  "], ["", 5,"cosθ","  y  "],
  ["", 5,"  y  ","sinθ"], ["", 5,"  y  ","cosθ"], 3
]];

const Qu24 = [
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとxはどれ"],
  ["rtanθ"], ["ytanθ"], ["", 5,"tanθ","  y  "], ["", 5,"  y  ","tanθ"], 4
],
[ ["直角三角形の斜辺をr、θの対辺をy、残りの辺をx、とするとyはどれ"],
  ["rtanθ"], ["xtanθ"], ["", 5,"tanθ","  x  "], ["", 5,"  x  ","tanθ"], 2
]];

const Qu25 = [
[ ["sin^2θ+cos^2θはどれ"],
  ["0"], ["1"], ["-1"], ["2"], 2
],
[ ["tanθはどれ"],
  [ "sinθcosθ"], ["", 5,"sinθ","cosθ"],
  ["-sinθcosθ"], ["", 5,"cosθ","sinθ"], 2
]];

//--------------------------------------------------------------------
// Quiz level 3
//--------------------------------------------------------------------
const Qu31 = [
[ ["仰角θのなめらかな斜面上の質量mの物体にかかる鉛直下方向の重力Wはどれ"],
  ["mg"], ["mgsinθ"], ["mgcosθ"], ["mgtanθ"], 1
]];

const Qu32 = [
[ ["仰角θのなめらかな斜面上の質量mの物体にかかる斜面に水平な方向の重力W_xはどれ"],
  ["mg"], ["mgsinθ"], ["mgcosθ"], ["mgtanθ"], 2
]];

const Qu33 = [
[ ["仰角θのなめらかな斜面上の質量mの物体にかかる斜面に垂直な方向の重力W_yはどれ"],
  ["mg"], ["mgsinθ"], ["mgcosθ"], ["mgtanθ"], 3
]];

const Qu34 = [
[ ["仰角θのなめらかな斜面上の質量mの物体にかかる斜面からの垂直抗力Nはどれ"],
  ["mg"], ["mgsinθ"], ["mgcosθ"], ["mgtanθ"], 3
]];

const Qu35 = [
[ ["仰角θのなめらかな斜面上の質量mの物体の斜面方向の加速度aはどれ"],
  ["g"], ["gsinθ"], ["gcosθ"], ["gtanθ"], 2
]];

//--------------------------------------------------------------------
// Quiz level 4
//--------------------------------------------------------------------
const Qu41 = [
[ ["最大静止摩擦力F_0はどれ(静止摩擦係数μ、垂直抗力N)"],
  ["μN"], ["", 2,"μ","_'N_'"], ["", 2,"_'N_'","μ"], ["μ+N"], 1
]];

const Qu42 = [
[ ["動摩擦力F_`'はどれ(動摩擦係数μ_`'、垂直抗力N)"],
  ["μ_`'N"], ["", 3,"μ_`'"," N "], ["", 3," N ","μ_`'"], ["μ_`'+N"], 1
]];

const Qu43 = [
[ ["水平な床上の質量mの物体にかかる床からの垂直抗力はどれ"],
  ["mg"], ["", 1,"m","g"], ["", 1,"g","m"], ["m+g"], 1
]];

const Qu44 = [
[ ["水平な床上の質量mの物体に働く最大静止摩擦力F_0はどれ(静止摩擦係数μ)"],
  ["μmg"], ["", 2,"μm","_'g_'"], ["", 2,"_'g_'","μm"], ["μm+g"], 1
]];

const Qu45 = [
[ ["水平な床上の質量mの物体に働く動摩擦力F_`'はどれ(動摩擦係数μ_`')"],
  ["μ_`'mg"], ["", 3,"μ_`'m"," g "], ["", 3," g ","μ_`'m"], ["μ_`'m+g"], 1
]];

//--------------------------------------------------------------------
// Quiz level 5
//--------------------------------------------------------------------
const Qu51 = [
[ ["仰角θのあらい斜面上の質量mの物体が静止している条件はどれ"],
  ["mgsinθ ≦ μmgcosθ"], ["mgsinθ ＞ μmgcosθ"],
  ["mgcosθ ≦ μmgsinθ"], ["mgcosθ ＞ μmgsinθ"], 1
],
[ ["仰角θのあらい斜面上の質量mの物体が静止している条件はどれ"],
  ["mgsinθ ≦ μN"], ["mgsinθ ＞ μN"],
  ["mgcosθ ≦ μN"], ["mgcosθ ＞ μN"], 1
],
[ ["仰角θのあらい斜面上の質量mの物体が静止している条件はどれ"],
  ["sinθ ≦ μcosθ"], ["sinθ ＞ μcosθ"],
  ["cosθ ≦ μsinθ"], ["cosθ ＞ μsinθ"], 1
]];

const Qu52 = [
[ ["仰角θのあらい斜面上の質量mの物体が静止しているときの静止摩擦力Fはどれ"],
  ["mgsinθ"], ["μmgcosθ"], ["mgcosθ"], ["μmgsinθ"], 1
],
[ ["仰角θのあらい斜面上の質量mの物体が静止しているときの静止摩擦力Fはどれ"],
  ["mgsinθ"], ["μN"], ["N"], ["μmgcosθ"], 1
]];

const Qu53 = [
[ ["仰角θのあらい斜面上の質量mの物体が滑っているときの動摩擦力F_`'はどれ"],
  ["μ_`'mgsinθ"], ["μ_`'mgcosθ"], ["μ_`'gsinθ"], ["μ_`'gcosθ"], 2
],
[ ["仰角θのあらい斜面上の質量mの物体が滑っているときの動摩擦力F_`'はどれ"],
  ["μ_`'mgsinθ"], ["μ_`'N"], ["μ_`'gsinθ"], ["", 3,"μ_`'N"," m "], 2
]];

const Qu54 = [
[ ["仰角θのあらい斜面上の質量mの物体が滑っているときの加速度aはどれ"],
  ["g(sinθ - μ_`'cosθ)"], ["g(cosθ - μ_`'sinθ)"],
  ["mg(sinθ - μ_`'cosθ)"], ["mg(cosθ - μ_`'sinθ)"], 1
],
[ ["仰角θのあらい斜面上の質量mの物体が滑っているときの加速度aはどれ"],
  ["gsinθ - ", 3,"μ_`'N"," m "], ["gcosθ - ", 3,"μ_`'N"," m "],
  ["mgsinθ - μ_`'N"], ["mgcosθ - μ_`'N"], 1
],
[ ["仰角θのあらい斜面上の質量mの物体が滑っているときの加速度aはどれ"],
  ["gsinθ - ", 2,"F_`'","_'m_'"], ["gcosθ - ", 2,"F_`'","_'m_'"],
  ["mgsinθ - F_`'"], ["mgcosθ - F_`'"], 1
]];

const Qu55 = [
[ ["あらい斜面の仰角θ_`_0を超えると滑り出したとき静止摩擦係数μとの関係はどれ"],
  ["μ = tanθ_`_0"], ["μ = cosθ_`_0"], ["μ = sinθ_`_0"], ["μ = θ_`_0"], 1
]];

const Quiz1 = [ Qu11, Qu12, Qu13, Qu14, Qu15 ];
const Quiz2 = [ Qu21, Qu22, Qu23, Qu24, Qu25 ];
const Quiz3 = [ Qu31, Qu32, Qu33, Qu34, Qu35 ];
const Quiz4 = [ Qu41, Qu42, Qu43, Qu44, Qu45 ];
const Quiz5 = [ Qu51, Qu52, Qu53, Qu54, Qu55 ];

const Quiz0 = [ Quiz1, Quiz2, Quiz3, Quiz4, Quiz5 ];

//--------------------------------------------------------------------
// public letiable
//--------------------------------------------------------------------
const B = new BASIC();
const C0 = '#000'
const C1 = '#24f'
const C2 = '#f88'
const C3 = '#f8f'
const C4 = '#8f8'
const C5 = '#8ff'
const C6 = '#ff8'
const C7 = '#fff'

let Temp; // debug

//------------------------------------------------------------------------------
// 変数
//------------------------------------------------------------------------------
class QUIZ
{
  constructor()
  {
    this.lev = this.cou = this.ans = this.yn = this.qui = 0;
    this.sta = 0;
    this.d   = [0, 0];
  }
  init()
  {
    this.lev  = 1;      // 難易度
    this.cou  = 1;      // 問題数
    this.ans  = 0;      // 解答番号(1-4)
    this.yn   = 0;      // 解答番号(1-2)
    this.d    = [0, 0]; // 角度θ[°]
    this.qui  = 0;      // Quiz
    this.sta  = 0;      // State 0:通常 1:正解 2:残念
  }
  area(n)
  {
    const a =
    [
      [  8, 200, 220,  40], // a
      [238, 200, 220,  40], // b
      [  8, 250, 220,  40], // c
      [238, 250, 220,  40], // d
      [  8, 330, 220,  40], // y
      [238, 330, 220,  40], // n
      [ 73,  19, 110, 110], // 1
      [278,  19, 110, 110]  // 2
    ];

    if (1 <= n && n <= 8) return a[n-1];
    return a.length;
  }
  state(n)
  {
    if (n != -1) this.sta = n;
    return this.sta;
  }
  level(n)
  {
    if (n != -1) this.lev = n;
    return this.lev;
  }
  count(n)
  {
    if (n != -1) this.cou = n;
    return this.cou;
  }
  answer(n)
  {
    if (this.sta < 2)
    {
      if (n != -1) this.ans = n;
    }
    return this.ans;
  }
  yesno(n)
  {
    if (n != -1) this.yn = n;
    return this.yn;
  }
  quiz(q)
  {
    if (q !== null) this.qui = q;
    return this.qui;
  }
  #fix(x)
  {
    let a;

    a = x.toFixed(1);
    return Number(a);
  }
  rad(d)
  {
    return d * Math.PI / 180;
  }
  deg(t)
  {
    return t * 180 / Math.PI;
  }
  setd(d, n)
  {
    while (d <    0) d += 360;
    while (d >= 360) d -= 360;
    d = this.#fix(d);
    this.d[n] = d;
    return this.d[n];
  }
  getd(n)
  {
    return this.d[n];
  }
}
const Q = new QUIZ();

//--------------------------------------------------------------------
// triangle
//--------------------------------------------------------------------
function triangle(r, d, n, lr)
{
  let x0, y0, x1, y1, x2, y2, x3, y3, x, y;
  let xn, yn, t0, t1, t, a, b, i;

  t1  = Q.rad(d);
  x2  = r * Math.cos(t1);
  y2  = r * Math.sin(t1);
  x0  = -x2 / 2;
  y0  = -y2 / 2;
  x2 += x0;
  y2 += y0;
  x1  = x2;
  y1  = y0;
  a   = r * 0.06;
  xn = [x0, x1, x2, x1-a, x1-a, x1  ];
  yn = [y0, y1, y2, y1  , y1+a, y1+a];

  d  = Q.getd(n);
  t0 = Q.rad(d);
  if (lr) t0 = -t0;
  a  = Math.cos(t0);
  b  = Math.sin(t0);
  for (i = 0; i < xn.length; i++)
  {
    x = xn[i]; y = yn[i];
    xn[i] = x * a - y * b;
    yn[i] = x * b + y * a;
  }

  d  = Q.area(7 + n);
  x  = d[0] + d[2] / 2;
  y  = d[1] + d[3] / 2;
  if (lr) B.WINDOW( x, y, x-639, y-399);
  else    B.WINDOW(-x, y, 639-x, y-399);
  B.LINE(xn[0], yn[0], xn[1], yn[1], C7);
  B.LINE2             (xn[2], yn[2], C7);
  B.LINE2             (xn[0], yn[0], C7);
  B.LINE(xn[3], yn[3], xn[4], yn[4], C7);
  B.LINE2             (xn[5], yn[5], C7);

  if (lr)
  {
    x -= xn[0];
    y -= yn[0];
    B.WINDOW( x, y, x-639, y-399);
  }
  else
  {
    x += xn[0];
    y -= yn[0];
    B.WINDOW(-x, y, 639-x, y-399);
  }
  a   = r * 0.2;
  t   = t0 + t1 * 0.5;
  t1 += t0;
  if (lr) { t0 = Math.PI - t0; t1 = Math.PI - t1; t = Math.PI - t; }
  B.CIRCLE(0, 0, a, C7, t0, t1, !lr);

  a = r * 0.27;
  x = a * Math.cos(t);
  y = a * Math.sin(t);
  if (lr) x = -x + 16;
  B.SYMBOL(x-8, y-7, "θ", C7);
}

//--------------------------------------------------------------------
// select
//--------------------------------------------------------------------
function select(n, c1, c0)
{
  let rect, x, y, w, h;

  rect = Q.area(n);
  x = rect[0];
  y = rect[1];
  w = rect[2];
  h = rect[3];
  B.LINEBF(x, y, x+w, y+h, c0);
  B.LINEB (x, y, x+w, y+h, c1);
}

//--------------------------------------------------------------------
// question
//--------------------------------------------------------------------
function shuffle(quiz)
{
  const s =
  [
    [1, 2, 3, 4], [1, 2, 4, 3],
    [1, 3, 2, 4], [1, 3, 4, 2],
    [1, 4, 2, 3], [1, 4, 3, 2],
    [2, 1, 3, 4], [2, 1, 4, 3],
    [2, 3, 1, 4], [2, 3, 4, 1],
    [2, 4, 1, 3], [2, 4, 3, 1],
    [3, 1, 2, 4], [3, 1, 4, 2],
    [3, 2, 1, 4], [3, 2, 4, 1],
    [3, 4, 1, 2], [3, 4, 2, 1],
    [4, 1, 2, 3], [4, 1, 3, 2],
    [4, 2, 1, 3], [4, 2, 3, 1],
    [4, 3, 1, 2], [4, 3, 2, 1]
  ];
  let q, i;

  q = [ 0, 1, 2, 3, 4, 5 ];
  i = Math.floor(Math.random() * s.length);
  i = s[i];
  q[  0 ] =   quiz[0]   ;
  q[i[0]] =   quiz[1]   ;
  q[i[1]] =   quiz[2]   ;
  q[i[2]] =   quiz[3]   ;
  q[i[3]] =   quiz[4]   ;
  q[  5 ] = i[quiz[5]-1];
  return q;
}

function question(lev, cou)
{
  let quiz, i;

  quiz = Quiz0[lev - 1];
  quiz = quiz [cou - 1];
  i = Math.floor(Math.random() * quiz.length);
  quiz = quiz[i];

  return shuffle(quiz)
}

//--------------------------------------------------------------------
// answer
//--------------------------------------------------------------------
function dispans1(i, a, b)
{
  let s;

  B.TAB(   0.5, -0.5); B.PRINTe(a);
  s = "".padEnd(i+1, '_');
  B.TAB(-i-0.5,  0  ); B.PRINT (s);
  B.TAB(-i-0.5,  1.0); B.PRINTe(b);
  B.TAB(   0  , -0.5);
}

function dispans(x, y, s, ans)
{
  let a, b, w, h, i, n, f;

  w = 8;
  h = 9;
  B.LOCATEp(x+w, y+h); B.PRINT(s + ": ");
  f = 1;
  n = ans.length;
  for (i = 0; i < n;)
  {
    if (f)
    {
      B.PRINTe(ans[i++]); f = 0; continue;
    }
    dispans1(ans[i], ans[i+1], ans[i+2]); i += 3; f = 1;
  }
}

function answer(quiz, n)
{
  let r;

  select(1, C7, (n == 1)? C3 : C1);
  select(2, C7, (n == 2)? C3 : C1);
  select(3, C7, (n == 3)? C3 : C1);
  select(4, C7, (n == 4)? C3 : C1);
  r = Q.area(1); dispans(r[0], r[1], "A", quiz[1]);
  r = Q.area(2); dispans(r[0], r[1], "B", quiz[2]);
  r = Q.area(3); dispans(r[0], r[1], "C", quiz[3]);
  r = Q.area(4); dispans(r[0], r[1], "D", quiz[4]);
}

//--------------------------------------------------------------------
// question
//--------------------------------------------------------------------
function dispque(ans)
{
  let a, b, w, h, i, n, f;

  f = 1;
  n = ans.length;
  for (i = 0; i < n;)
  {
    if (f)
    {
      B.PRINTe(ans[i++]); f = 0; continue;
    }
    dispans1(ans[i], ans[i+1], ans[i+2]); i += 3; f = 1;
  }
}

//--------------------------------------------------------------------
// yes no
//--------------------------------------------------------------------
function yesno(n)
{
  let r;

  select(5, C7, (n == 1)? C3 : C1);
  select(6, C7, (n == 2)? C3 : C1);
  r = Q.area(5); dispans(r[0], r[1], "Y", ["Yes."]);
  r = Q.area(6); dispans(r[0], r[1], "N", ["No." ]);
}

//--------------------------------------------------------------------
// gold
//--------------------------------------------------------------------
function gold(x, y)
{
  let n, c;

  n = Q.count(-1);
  if (n == 6) c = C5; else if (n == 5) c = C7; else c = C1;
  B.LOCATE(x, y  ); B.COLOR(c); B.PRINT("5問目  1,000,000点");
  if (n == 5) c = C5; else if (n == 4) c = C7; else c = C1;
  B.LOCATE(x, y+1); B.COLOR(c); B.PRINT("4問目    100,000点");
  if (n == 4) c = C5; else if (n == 3) c = C7; else c = C1;
  B.LOCATE(x, y+2); B.COLOR(c); B.PRINT("3問目     10,000点");
  if (n == 3) c = C5; else if (n == 2) c = C7; else c = C1;
  B.LOCATE(x, y+3); B.COLOR(c); B.PRINT("2問目      1,000点");
  if (n == 2) c = C5; else if (n == 1) c = C7; else c = C1;
  B.LOCATE(x, y+4); B.COLOR(c); B.PRINT("1問目        100点");
}

//--------------------------------------------------------------------
// gold
//--------------------------------------------------------------------
const QuizN = 5;
function next(count)
{
  let q;

  Q.count(count);
  if (count <= QuizN) Q.state(0); else count = QuizN;
  Q.answer(0);
  Q.yesno(0);
  q = question(Q.level(-1), count);
  Q.quiz(q);
  blur();
  window.requestAnimationFrame(main);
}

//--------------------------------------------------------------------
// screen
//--------------------------------------------------------------------
function display()
{
  const s = ['A', 'B', 'C', 'D'];
  let q, a, n;

  B.FONT(1,0);
  B.CLS('#002');

  triangle(125, 30, 0, 0);
  triangle(125, 30, 1, 1);
  B.WINDOW(0, 0, 639, 399);

  gold(59, 1);
  B.COLOR(C7);
  B.LOCATE(0, 8);
  n = Q.count(-1); if (n > QuizN) n = QuizN;
  q = Q.quiz(null);
  B.TAB(1, 0); B.PRINT(n + "問目"); B.CR(); B.CR();
  B.TAB(1, 0); dispque(q[0]); B.CR();

  a = Q.answer(-1);
  answer(q, a);
  n = 0;
  if (a > 0)
  {
    if (Q.state(-1) < 2)
    {
      n = Q.yesno(-1);   
      yesno(n);
    }
    B.LOCATE(0, 19);
    B.TAB(1, 0); B.PRINT (s[a-1] + "でファイナルアンサー?");
    if (n == 1 || Q.state(-1) > 0)
    {
      if (a == q[5])
      {
        if (Q.state(-1) == 1)
        {
          if (Q.count(-1) < QuizN)
          {
            switch(n)
            {
              case 1: next(Q.count(-1) + 1); return;
              case 2: next(Q.count(-1)    ); return;
            }
          }
          else
          {
            if (n > 0) { next(1); return; }
          }
        }
        B.TAB(1, 0); B.PRINT ("正解!");
        if (Q.count(-1) < QuizN)
        {
          B.PRINT ("  次の問題に進みますか?");
          Q.state(1);
        }
        else
        {
          if (Q.state(-1) < 2) Q.count(Q.count(-1)+1);
          B.TAB(1, 0); B.PRINT("おめでとうございます!!");
          B.CR(); B.CR();
          B.TAB(1, 0); B.PRINT("もう一度挑戦するときは");
                       B.PRINT("ResetかLevelボタンを押して下さい");
          B.CR();
          Q.state(2);
        }
        Q.yesno(0);
        if (n > 0) window.requestAnimationFrame(display);
        return;
      }
      else
      {
        B.TAB(1, 0); B.PRINT ("残念!");
        B.CR(); B.CR();
        B.TAB(1, 0); B.PRINT("もう一度挑戦するときは");
        B.TAB(1, 0); B.PRINT("ResetかLevelボタンを押して下さい");
        B.CR();
        Q.state(2);
        Q.yesno(0);
        if (n > 0) window.requestAnimationFrame(display);
        return;
      }
    }
  }

  Q.yesno(0);
  if (n == 2)
  {
    Q.answer(0);
    window.requestAnimationFrame(display);
  }

  B.LOCATE(0, 0);
  B.COLOR('#fff');
//  B.TAB(1, 0); B.PRINT(Temp); B.CR();
}

//--------------------------------------------------------------------
// input
//--------------------------------------------------------------------
function pushinit()
{
  let v, i;

  v = document.getElementById("target");
  for (i = 0; i < v.length; i++)
  {
    v[i].checked = false;
  }
  v[v.length-1].checked = true;
}

function pushget()
{
  let v, i;

  v = document.getElementById("target");
  for (i = 0; i < v.length; i++)
  {
    if (v[i].checked) { Q.level(5 - i); break; }
  }
  window.requestAnimationFrame(display);
}

function blur()
{
  document.getElementById('lvl_5').blur();
  document.getElementById('lvl_4').blur();
  document.getElementById('lvl_3').blur();
  document.getElementById('lvl_2').blur();
  document.getElementById('lvl_1').blur();

  document.getElementById('butS').blur();
  document.getElementById('butR').blur();
  document.getElementById('butQ').blur();
  document.getElementById('butW').blur();
  document.getElementById('butZ').blur();
  document.getElementById('butX').blur();
  document.getElementById('butC').blur();
}

function reset()
{
  pushget();
  next(1);
}

function pushlvl()
{
  let v, i;

  v = document.getElementById("target");
  for (i = 0; i < v.length; i++)
  {
    if (v[i].checked) { Q.level(5 - i); break; }
  }
  Q.count(1);
  reset();
}

document.getElementById("target"  ).addEventListener('input', pushlvl);

function keylvl(x)
{
  let v, i;

  v = document.getElementById("target");
  for (i = 0; i < v.length; i++)
  {
    v[i].checked = (i == x)? true : false;
  }
  pushlvl();
  reset();
}

//--------------------------------------------------------------------
// init
//--------------------------------------------------------------------
function init()
{
  Q.init();
  pushinit();
  reset();
}

//--------------------------------------------------------------------
// Input key
//--------------------------------------------------------------------
function keyon(key)
{
  let f, d, s, n;

  f = 0;
  // SHIFT16 CTRL17 ALT18
  if      (Key[ 16]) { s =  5; }
  else               { s = 15; }

  if      (Key[ 38] || key == 38) //↑
  {
    n = 0; d = Q.getd(n);
    d += s; f = 1;
  }
  else if (Key[ 40] || key == 40) //↓
  {
    n = 0; d = Q.getd(n);
    d -= s; f = 1;
  }
  else if (Key[ 39] || key == 39) //→
  {
    n = 1; d = Q.getd(n);
    d -= s; f = 1;
  } 
  else if (Key[ 37] || key == 37) //←
  {
    n = 1; d = Q.getd(n);
    d += s; f = 1;
  }
  if (f == 0) return 0;
  Q.setd(d, n);
  return 1;
}

function inkey(key)
{
  switch (key)
  {
    case  13: Q.setd(0, 0); Q.setd(0, 1); key = 0; break; // Enter
    case  32: reset(); key = 0; break; // ' '
    case  81: B.lineWidth( 0.5); key = 0; break; // 'Q'
    case  87: B.lineWidth( 2  ); key = 0; break; // 'W'
    case  90: B.zooming  (-1  ); key = 0; break; // 'Z'
    case  88: B.zooming  ( 1  ); key = 0; break; // 'X'
    case  86: B.zooming  ( 0  ); key = 0; break; // 'V'
    case  53: keylvl(0)  ; key = 0; break; // '5'
    case  52: keylvl(1)  ; key = 0; break; // '4'
    case  51: keylvl(2)  ; key = 0; break; // '3'
    case  50: keylvl(3)  ; key = 0; break; // '2'
    case  49: keylvl(4)  ; key = 0; break; // '1'
    case  65: Q.answer(1); key = 0; break; // 'a'
    case  66: Q.answer(2); key = 0; break; // 'b'
    case  67: Q.answer(3); key = 0; break; // 'c'
    case  68: Q.answer(4); key = 0; break; // 'd'
    case  89: Q.yesno(1) ; key = 0; break; // 'y'
    case  78: Q.yesno(2) ; key = 0; break; // 'n'
    default : if (keyon(key))    key = 0;
  }
  if (key) return;
  blur();
  window.requestAnimationFrame(display);
}
document.body.addEventListener('keydown', event =>
{
  let key = event.keyCode;

  inkey(key);
});

//--------------------------------------------------------------------
// Key status
//--------------------------------------------------------------------
let Key = new Array(256);
for (let i = 0; i < 256; i++) Key[i] = 0;
window.onkeydown = function(event) { Key[event.keyCode] = 1; }
window.onkeyup   = function(event) { Key[event.keyCode] = 0; }

//----------------------------------------------------------------------
// mouse
//----------------------------------------------------------------------
function mouseDn(x, y, touch)
{
  let x1, y1, d, d1, i;

  if (!(0 <= x && x <= canvas.width )) return 0;
  if (!(0 <= y && y <= canvas.height)) return 0;

  x1 = B.winX(x);
  y1 = B.winY(y);

  d1 = -1;
  for (i = 1; i <= Q.area(0); i++)
  {
    d = Q.area(i);
    if ((d[0] <= x1 && x1 < d[0] + d[2])
     && (d[1] <= y1 && y1 < d[1] + d[3]))
    {
      if      (i <= 4) { Q.answer(i)   ; }
      else if (i <= 6) { Q.yesno(i - 4); }
      else             { d1 = i - 7; break; }
      blur();
      window.requestAnimationFrame(display);
      return 0;
    }
  }
  if (d1 < 0) return 0;

  i = d1;
  x1  = x1 - (d[0] + d[2] / 2);
  y1  = (d[1] + d[3] / 2) - y1;
  d1  = Math.atan2(y1, x1);
  d1  = Q.deg(d1);
  d1 -= Q.getd(i);

  M.ofsX(d1);
  M.ofsY(i );
  blur();
  return 1;
}

function mouseMv(x, y, touch)
{
  let x1, y1, d, d1, i;

  d1 = M.ofsX('');
  i  = M.ofsY('');
  d  = Q.area(i+7);
  x1 = B.winX(x);
  y1 = B.winY(y);
  x1  = x1 - (d[0] + d[2] / 2);
  y1  = (d[1] + d[3] / 2) - y1;

  d  = Math.atan2(y1, x1);
  d  = Q.deg(d);
  d -= d1;
  d1 = 15;
  d  = Math.round(d / d1) * d1;
  Q.setd(d, i);
  blur();
  window.requestAnimationFrame(display);
}

const M = new MOUSE();
M.add();
M.mosDnFunc(mouseDn);
M.mosMvFunc(mouseMv);

//--------------------------------------------------------------------
// main
//--------------------------------------------------------------------
function main()
{
  display();
}
init();

//--------------------------------------------------------------------
</script>
</body>
</html>
